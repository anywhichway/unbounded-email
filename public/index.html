<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Unbounded Email</title>
        <script src="./assets/js/lightview.js"></script>
        <script>
            const lightview = Lightview("browser");
            const {render, state, local} = lightview;
        </script>
        <link rel="stylesheet" href="./index.css">
    </head>
    <body>
        <script type="module" id="init">
            const master = await fetch("./assets/data/index.json").then(r => r.json());
            master.user.addContact = function(contact) {
                this.push(contact);
            }
            master.user.removeContact = function(contactId) {
                
            }
            await lightview.export(master, { publish: true, subscribe: true });
            await render({
                tagName: "div",
                attributes: {
                    id: "app",
                },
                children: [
                    {
                        tagName: "div",
                        attributes: {
                            id: "header",
                        }
                    },
                    {
                        tagName: "div",
                        attributes: {
                            id: "content"
                        },
                        children: [
                            {
                                tagName: "div",
                                attributes: {
                                    id: "plugins"
                                },
                                children: master.ui.plugins
                            },
                            {
                                tagName: "iframe",
                                attributes: {
                                    id: "pluginView",
                                    src: "./plugins/index.html",
                                    onchange(event) {
                                         lightview.export(master);
                                    }
                                }
                            }
                        ]
                    },
                    {
                        tagName: "div",
                        attributes: {
                            id: "footer"
                        }
                    }
                ]
            },{replaceEl:document.getElementById("init"),state:master});
            // Custom navigation handler that works reliably
            master.navigate = (url, baseUrl = null) => {
                const pluginView = document.getElementById('pluginView');
                if (pluginView) {
                    const resolvedUrl = baseUrl ? new URL(url, baseUrl).href : url;
                    pluginView.src = resolvedUrl;
                }
            };
            
        </script>
    </body>
</html>
